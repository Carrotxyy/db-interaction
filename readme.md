#### 微信访客系统 —同步— 本地管理系统 

#### 1.业主信息同步

- ##### 本地上传业主信息

- 判断业主信息标志位 Per_Mark 是否为 "0" （表示当前业主信息发生过变动！暂未同步到微信访客系统）

  将为"0"的数据，上传到微信访客系统

  

- ##### 微信访客接受信息

- 接受数据，遍历数据，查看Per_Status 和 Per_AllowVisit 是否为 "0"

  如果其中一个值**不为"0"**,则获取当前数据的Per_ContactTel , 去sync_owners 、owners删除对应数据

  如果**都为"0"**,则添加到 sync_owners

  **这里就有个问题，如果有一个人一开始具有权限，并且在微信公众号中注册了业主。**

  **如果被管理员取消了权限之后又开启了权限，那么必须重新去微信公众号注册业主！！**

  

#### 2.下载访客数据

- ##### 微信访客 发送信息

- 先读取redis 中 newest-visitor表( 存放的是最新的访客openid)

  如果**存在数据**，则 拼接表名 user:openid ,获取访客信息,下发成功后，**将newest-visitor表删除**



- ##### 本地下拉数据

- 访问接口，获取数据，存入数据库中 go_visitor表